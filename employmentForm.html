<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Application for Employment</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>

<body class="bg-light">
    <div class="container py-4">
        <h2 class="mb-4 text-center">ANNEXURE B</h2>
        <h2 class="mb-4 text-center">APPLICATION FORM FOR EMPLOYMENT</h2>
        <br>
        <p class="text-start">The purpose of this form is to assist a municipality in selecting suitable candidates for
            an advertised post.

            This form must be completed in full, accurately and legibly. All substantial information relevant to a
            candidate must be provided in this form. Any additional information may be provided on the CV.
            Candidates shortlisted for interviews may be requested to furnish additional information that will assist
            municipalities to expedite recruitment and selection processes.
            All information received shall be treated with strict confidentiality and shall not be used for any other
            purpose than to assess the suitability of the applicant.
            This form is designed to assist municipality with the recruitment, selection and appointment of staff
            members in terms of the Municipal Systems Act, 2000 (Act No. 32 of 2000) </p>
        <form class="row g-3">
            <!-- Advertised Post Details -->
            <h5>DETAILS OF THE ADVERTISED POST (as reflected in the advert)</h5>
            <div class="col-md-6">
                <label class="form-label">Advertised post applying for</label>
                <input type="text" class="form-control" name="post" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">Reference Number</label>
                <input type="text" class="form-control" name="refNumber">
            </div>
            <div class="col-md-6">
                <label class="form-label">Name of the Municipality</label>
                <input type="text" class="form-control" name="municipality">
            </div>
            <div class="col-md-6">
                <label class="form-label">Notice service Period</label>
                <input type="text" class="form-control" name="noticePeriod">
            </div>

            <!-- Personal Details -->
            <h5 class="mt-4">PERSONAL DETAILS </h5>
            <div class="col-md-6">
                <label class="form-label">Surname</label>
                <input type="text" class="form-control" name="surname" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">First Names</label>
                <input type="text" class="form-control" name="firstNames" required>
            </div>
            <div class="col-md-6">
                <label class="form-label">ID or Passport Number</label>
                <input type="text" class="form-control" name="idNumber" required>
            </div>
            <div class="col-md-3">
                <label class="form-label">Gender</label>
                <select class="form-select" name="gender">
                    <option selected disabled>Choose...</option>
                    <option>Male</option>
                    <option>Female</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Race</label>
                <select class="form-select" name="race">
                    <option selected disabled>Choose...</option>
                    <option>African</option>
                    <option>White</option>
                    <option>Coloured</option>
                    <option>Indian</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Do you have a disability?</label>
                <select class="form-select" name="disability">
                    <option>No</option>
                    <option>Yes</option>
                </select>
            </div>
            <div class="col-md-9">
                <label class="form-label">If yes, elaborate</label>
                <input type="text" class="form-control" name="disabilityDetails">
            </div>
            <div class="col-md-3">
                <label class="form-label">SA Citizen?</label>
                <select class="form-select" name="citizen">
                    <option>Yes</option>
                    <option>No</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">If not, nationality</label>
                <input type="text" class="form-control" name="nationality">
            </div>
            <div class="col-md-3">
                <label class="form-label">Work Permit?</label>
                <select class="form-select" name="workPermit">
                    <option>Yes</option>
                    <option>No</option>
                </select>
            </div>

            <!-- Professional Membership -->
            <h5 class="mt-4">Do you hold a professional
                membership with any
                professional body? </h5>
            <div class="col-md-3">
                <label class="form-label">Are you a member?</label>
                <select class="form-select" name="hasMembership">
                    <option>Yes</option>
                    <option>No</option>
                </select>
            </div>
            <div class="col-md-3">
                <label class="form-label">Name of Professional Body</label>
                <input type="text" class="form-control" name="bodyName">
            </div>
            <div class="col-md-3">
                <label class="form-label">Membership Number</label>
                <input type="text" class="form-control" name="membershipNumber">
            </div>
            <div class="col-md-3">
                <label class="form-label">Expiry Date</label>
                <input type="date" class="form-control" name="expiryDate">
            </div>

            <!-- Contact Details -->
            <h5 class="mt-4">CONTACT DETAILS </h5>
            <div class="col-md-4">
                <label class="form-label">Telephone number during office hours </label>
                <input type="tel" class="form-control" name="telephone">
            </div>
            <div class="col-md-4">
                <label class="form-label">Mobile phone number </label>
                <input type="tel" class="form-control" name="mobile">
            </div>
            <div class="col-md-4">
                <label class="form-label">Email Address</label>
                <input type="email" class="form-control" name="email" required>
            </div>
            <div class="col-md-8">
                <label class="form-label">Postal Address</label>
                <input type="text" class="form-control" name="address">
            </div>
            <div class="col-md-4">
                <label class="form-label">Postal Code</label>
                <input type="text" class="form-control" name="postalCode">
            </div>
            <div class="col-md-6">
                <label class="form-label">Preferred language of communication </label>
                <select class="form-select" name="language">
                    <option>English</option>
                    <option>IsiZulu</option>
                    <option>IsiXhosa</option>
                    <option>Sotho</option>
                    <option>Other</option>
                </select>
            </div>

            <!-- Qualifications -->
            <h5 class="mt-4">QUALIFICATIONS (please elaborate on your CV) </h5>
            <div class="col-md-6">
                <label class="form-label">Highest educational qualification obtained </label>
                <input type="text" class="form-control" name="schoolQualification">
            </div>
            <div class="col-md-6">
                <label class="form-label">Name of the School</label>
                <input type="text" class="form-control" name="schoolName">
            </div>
            <div class="col-md-6">
                <label class="form-label">Highest Grade</label>
                <input type="text" class="form-control" name="schoolGrade">
            </div>
            <div class="col-md-6">
                <label class="form-label">Year Obtained</label>
                <input type="text" class="form-control" name="schoolYear">
            </div>
            
            <div class="col-md-6">
                <label class="form-label">Highest tertiary qualification obtained</label>
                <input type="text" class="form-control" name="tertiary">
            </div>
            <div class="col-md-3">
                <label class="form-label">Name of Institution </label>
                <input type="text" class="form-control" name="nameOfInstitution">
            </div>
            <div class="col-md-3">
                <label class="form-label">Name of a qualification</label>
                <input type="text" class="form-control" name="nameOfQualification">
            </div>
            <div class="col-md-3">
                <label class="form-label">NQF Level</label>
                <input type="text" class="form-control" name="nqfLevel">
            </div>
            <div class="col-md-3">
                <label class="form-label">Year Obtained</label>
                <input type="text" class="form-control" name="tertiaryYear">
            </div>

            <!-- Experience -->
            <h5 class="mt-4">Work Experience</h5>
            <div class="col-12">
                <textarea class="form-control" rows="4"
                    placeholder="List Employers, Posts Held, Dates, and Reasons for Leaving"
                    name="experience"></textarea>
            </div>

            <!-- Disciplinary -->
            <h5 class="mt-4">Disciplinary Record</h5>
            <div class="row align-items-end mb-3">
                <div class="col-md-3">
                    <label class="form-label">Dismissed in last 10 years?</label>
                    <select class="form-select" name="dismissed">
                        <option>No</option>
                        <option>Yes</option>
                    </select>
                </div>
                <div class="col-md-9">
                    <label class="form-label invisible">Details</label>
                    <input type="text" class="form-control" placeholder="If yes, provide details" name="disciplinaryDetails">
                </div>
            </div>

            <!-- Criminal -->
            <h5 class="mt-4">Criminal Record</h5>
            <div class="row align-items-end mb-3">
                <div class="col-md-3">
                    <label class="form-label">Convicted in last 10 years?</label>
                    <select class="form-select" name="criminal">
                        <option>No</option>
                        <option>Yes</option>
                    </select>
                </div>
                <div class="col-md-9">
                    <label class="form-label invisible">Details</label>
                    <input type="text" class="form-control" placeholder="If yes, provide details" name="criminalDetails">
                </div>
            </div>

            <!-- References -->
            <h5 class="mt-4">References</h5>
            <div class="col-12">
                <textarea class="form-control" rows="3"
                    placeholder="List Names, Relationship, Contact Numbers and Emails" name="references"></textarea>
            </div>

            <!-- Declaration -->
            <h5 class="mt-4">Declaration</h5>
            <div class="col-12">
                <p>I declare that the information provided is true and correct. Misrepresentation may lead to
                    disqualification.</p>
            </div>
            <div class="col-md-6">
                <label class="form-label">Signature</label>
                <canvas id="signature" height="150" style="border:1px solid #333; width:100%;"></canvas>
                <div class="d-flex justify-content-between mt-2">
                    <button type="button" class="btn btn-secondary btn-sm" onclick="clearSig()">Clear Signature</button>
                </div>
            </div>
            <div class="col-md-6">
                <label class="form-label">Upload Document(s) (PDF, up to 5)</label>
                <input type="file" class="form-control mb-2" id="attachment" accept="application/pdf" multiple>
                <ul id="fileList" class="list-group mb-2"></ul>
            </div>

            <!-- Submit Button -->
            <div class="col-12 text-center mt-4">
                <button type="submit" class="btn btn-primary px-5">Submit Application</button>
            </div>
        </form>
    </div>

    <!-- Signature Pad Script -->
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.1.5/dist/signature_pad.umd.min.js"></script>
    <script>
        // Responsive SignaturePad Fix
        let signaturePad;
        function resizeSignatureCanvas(restoreData) {
            const canvas = document.getElementById('signature');
            const ratio = window.devicePixelRatio || 1;
            // Match the canvas's width to its displayed width
            const width = canvas.offsetWidth;
            canvas.width = width * ratio;
            canvas.height = 150 * ratio;
            canvas.getContext("2d").scale(ratio, ratio);
            if (signaturePad && restoreData) {
                signaturePad.fromData(restoreData);
            }
        }

        // Initial resize before creating SignaturePad
        resizeSignatureCanvas();

        // Now create the SignaturePad instance
        signaturePad = new SignaturePad(document.getElementById('signature'));

        // On window resize, save and restore signature
        window.addEventListener('resize', () => {
            const data = signaturePad.toData();
            resizeSignatureCanvas(data);
            signaturePad.clear();
            if (data && data.length) {
                signaturePad.fromData(data);
            }
        });

        function clearSig() {
            signaturePad.clear();
        }

        let selectedFiles = [];
        const fileInput = document.getElementById("attachment");
        const fileList = document.getElementById("fileList");

        fileInput.addEventListener("change", function (e) {
            const files = Array.from(e.target.files);
            for (let file of files) {
                if (selectedFiles.length >= 5) {
                    alert("You can upload up to 5 PDF documents.");
                    break;
                }
                if (file.type !== "application/pdf") {
                    alert("Only PDF files are allowed.");
                    continue;
                }
                if (!selectedFiles.some(f => f.name === file.name && f.size === file.size)) {
                    selectedFiles.push(file);
                }
            }
            updateFileList();
            fileInput.value = "";
        });

        function updateFileList() {
            fileList.innerHTML = "";
            selectedFiles.forEach((file, idx) => {
                const li = document.createElement("li");
                li.className = "list-group-item d-flex justify-content-between align-items-center";
                li.textContent = file.name;
                const removeBtn = document.createElement("button");
                removeBtn.type = "button";
                removeBtn.className = "btn btn-danger btn-sm";
                removeBtn.textContent = "Remove";
                removeBtn.onclick = () => {
                    selectedFiles.splice(idx, 1);
                    updateFileList();
                };
                li.appendChild(removeBtn);
                fileList.appendChild(li);
            });
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result.split(",")[1]);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }

        document.querySelector("form").addEventListener("submit", async (e) => {
            e.preventDefault();
            const form = e.target;

            if (signaturePad.isEmpty()) {
                alert("Please provide a signature.");
                return;
            }
            if (selectedFiles.length === 0) {
                alert("Please upload at least one PDF document.");
                return;
            }

            const attachments = [];
            for (let file of selectedFiles) {
                attachments.push(await fileToBase64(file));
            }

            const formData = new FormData(form);
            const payload = {};
            formData.forEach((value, key) => {
                payload[key] = value;
            });
            payload.signature = signaturePad.toDataURL();
            payload.attachments = attachments;

            try {
                const response = await fetch("https://prod-109.westeurope.logic.azure.com:443/workflows/f895d70992074e43b1a136c821ec649b/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=nLly136T7oij1CSbaoG6GMvVelgb4cvdpCtHp2O3Qw0", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(payload)
                });

                if (response.ok) {
                    alert("Form submitted successfully!");
                    form.reset();
                    signaturePad.clear();
                    selectedFiles = [];
                    updateFileList();
                } else {
                    alert("Submission failed.");
                }
            } catch (error) {
                alert("Error processing submission: " + error.message);
            }
        });
    </script>
</body>

</html>